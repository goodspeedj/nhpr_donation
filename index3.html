<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>

    <style>
        path {
          stroke: #000000;
          stroke-width: 0.25px;
          fill: gray;
        }

        .states {
          fill: none;
          stroke: #fff;
          stroke-linejoin: round;
        }

        .subunit-label {
          fill: #777;
          fill-opacity: .5;
          font-size: 20px;
          font-weight: 300;
          text-anchor: middle;
        }

        .vt {
          fill: green;
        }

    </style>

    <!-- D3 Libraries -->
    <script src="js/d3.v3.min.js" charset="utf-8"></script>
    <script src="js/queue.v1.min.js" charset="utf-8"></script>
    <script src="js/topojson.v1.min.js" charset="utf-8"></script>

  </head>
  <body>

    <div id="map"></div>

    <script type="text/javascript">
        

        var width = 550,
            height = 770;

        var tooltip = d3.select("#map").append("div")
            .attr("class", "tooltip");

        var fill = d3.scale.log()
            .domain([10, 500])
            .range(["white", "#006600"]);


        var color = d3.scale.threshold()
            .domain([0, 1000, 2000, 3000, 4000, 5000, 6000, 7000, 8000, 9000, 10000])
            .range(["#FFFFFF", "#F7FCFD", "#E5F5F9", "#CCECE6", "#99D8C9", "#66C2A4", "#41AE76", "#238B45", "#006D2C", "#00441B", "#002900"]);




        var projection = d3.geo.albers()
            .center([0, 43.9])
            .rotate([71.5, 0])
            .parallels([50, 60])
            .scale(15000)
            .translate([width / 2, height / 2]);

        var path = d3.geo.path()
            .projection(projection);

        var svg = d3.select("#map").append("svg")
            .attr("width", width)
            .attr("height", height);


        queue()
          .defer(d3.json, "data/ne_map.json")
          .defer(d3.csv, "data/id-zip.csv")
          .await(ready);

        function ready(error, map, zip) {
            var zipById = {};

            zip.forEach(function(d) { zipById[d.id] = +d.amt; });

            svg.append("g")
                .attr("class", "vermont")
              .selectAll("path")
                .data(topojson.feature(map, map.objects.g_vermont).features)
              .enter().append("path")
                .attr("class", function(d, i) { return i; })
                .attr("d", path)
                .style("fill", "gray")
                .style("fill-opacity", ".5");
                //.style("fill", function(d, i) { console.log(zipById[i]); return color(zipById[i]); });

            svg.append("path")
                .datum(topojson.mesh(map, map.objects.g_vermont, function(a, b) { return a.id !== b.id; }))
                .attr("class", "vt")
                .attr("d", path);

            svg.append("g")
                .attr("class", "new_hamp")
              .selectAll("path")
                .data(topojson.feature(map, map.objects.g_nh).features)
              .enter().append("path")
                .attr("class", function(d, i) { return i; })
                .attr("d", path)
                .style("fill", function(d, i) { console.log(zipById[i]); return color(zipById[i]); });

            svg.append("path")
                .datum(topojson.mesh(map, map.objects.g_nh, function(a, b) { return a.id !== b.id; }))
                .attr("class", "nh")
                .attr("d", path);

            svg.append("g")
                .attr("class", "maine")
              .selectAll("path")
                .data(topojson.feature(map, map.objects.g_maine).features)
              .enter().append("path")
                .attr("class", function(d, i) { return i; })
                .attr("d", path)
                .style("fill", "gray")
                .style("fill-opacity", ".5");

            svg.append("path")
                .datum(topojson.mesh(map, map.objects.g_maine, function(a, b) { return a.id !== b.id; }))
                .attr("class", "me")
                .attr("d", path);

            svg.append("g")
                .attr("class", "mass")
              .selectAll("path")
                .data(topojson.feature(map, map.objects.g_mass).features)
              .enter().append("path")
                .attr("class", function(d, i) { return i; })
                .attr("d", path)
                .style("fill", "gray")
                .style("fill-opacity", ".5");

            svg.append("path")
                .datum(topojson.mesh(map, map.objects.g_mass, function(a, b) { return a.id !== b.id; }))
                .attr("class", "ma")
                .attr("d", path);
          }   

    </script>

  </body>
</html>